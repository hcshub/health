<?xml version="1.0" encoding="UTF-8" ?>
        <!DOCTYPE mapper
                PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.golday.dao.UserDao">
    <select id="findByUsername" parameterType="string" resultMap="findUserByUsername">
        SELECT u.id, u.`username`, u.`password`,
	            ur.role_id, r.`keyword` role_keyword,
	            rp.`permission_id`, p.`keyword` permission_keyword
         FROM
                t_user u,t_user_role ur,t_role r,t_role_permission rp,t_permission p
         WHERE u.id = ur.user_id AND ur.role_id = r.`id`
                AND r.id = rp.`role_id` AND rp.permission_id = p.`id`
                AND u.`username` = #{username}
    </select>

    <resultMap id="findUserByUsername" type="User">
        <id column="id" property="id"/>
        <result column="username" property="username"/>
        <result column="password" property="password"/>
        <collection property="roles" ofType="Role">
            <id column="role_id" property="id"/>
            <result column="role_keyword" property="keyword"/>
            <collection property="permissions" ofType="Permission">
                <id column="permission_id" property="id"/>
                <result column="permission_keyword" property="keyword"/>
            </collection>
        </collection>
    </resultMap>

    <select id="findByNumber" parameterType="string" resultType="int">
       <![CDATA[select count(id) from t_member where regTime <= #{time}]]>
    </select>

    <select id="findByCheckgroupReport" resultType="map">
        SELECT p.`name`, COUNT(o.id) `value` FROM t_order o,t_package p
            WHERE o.package_id = p.id
            GROUP BY p.id
    </select>
</mapper>